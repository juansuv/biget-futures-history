{
  "Comment": "Parallel processing of Bitget trading symbols to extract orders",
  "StartAt": "ProcessSymbolsInParallel",
  "States": {
    "ProcessSymbolsInParallel": {
      "Type": "Map",
      "ItemsPath": "$.symbols",
      "MaxConcurrency": 50,
      "Iterator": {
        "StartAt": "ProcessSingleSymbol",
        "States": {
          "ProcessSingleSymbol": {
            "Type": "Task",
            "Resource": "arn:aws:states:::lambda:invoke",
            "Parameters": {
              "FunctionName": "${SymbolProcessorLambdaArn}",
              "Payload": {
                "symbol.$": "$"
              }
            },
            "ResultPath": "$.result",
            "End": true
          }
        }
      },
      "ResultPath": "$.parallel_results",
      "Next": "CollectResults"
    },
    "CollectResults": {
      "Type": "Task",
      "Resource": "arn:aws:states:::lambda:invoke",
      "Parameters": {
        "FunctionName": "${ResultCollectorLambdaArn}",
        "Payload": {
          "parallel_results.$": "$.parallel_results",
          "original_input.$": "$"
        }
      },
      "ResultPath": "$.final_result",
      "End": true
    }
  }
}